"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var Familiarity={Unknown:"Unknown",Indefinite:"Indefinite",Definite:"Definite"},Identity=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"someone",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"someone";_classCallCheck(this,t),this.definite=e,this.indefinite=i,this.unknown=n,this.state=Familiarity.Unknown,this.raiseToIndefinite="",this.raiseToDefinite=""}return _createClass(t,[{key:"getName",value:function(){switch(this.state){case Familiarity.Unknown:return this.unknown;case Familiarity.Indefinite:return this.indefinite;case Familiarity.Definite:return this.definite}}},{key:"getFamiliarityOrder",value:function(t){switch(t){case Familiarity.Unknown:return 0;case Familiarity.Indefinite:return 1;case Familiarity.Definite:return 2}}},{key:"isHigherFamiliarity",value:function(t){return this.getFamiliarityOrder(this.state)<this.getFamiliarityOrder(t)}},{key:"printFamiliarityChange",value:function(t){switch(t){case Familiarity.Definite:return this.raiseToDefinite;case Familiarity.Indefinite:return this.raiseToIndefinite}return""}},{key:"raiseFamiliarity",value:function(t){return t in Familiarity&&this.isHigherFamiliarity(t)?(this.state=t,this.printFamiliarityChange(t)):""}}]),t}(),Action=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";_classCallCheck(this,t),this.visibleText=e,this.audibleText=i,this.audibleFarText=n,this.wasSeen=!1,this.wasHeard=!1}return _createClass(t,[{key:"getVisibleText",value:function(){return this.wasSeen=!0,this.visibleText}},{key:"getAudibleText",value:function(){return this.wasSeen?"":(this.wasHeard=!0,this.audibleText)}},{key:"getAudibleFarText",value:function(){return this.wasSeen||this.wasHeard?"":(this.wasHeard=!0,this.audibleFarText)}}]),t}(),Character=function(){function t(e,i,n){_classCallCheck(this,t),this.identity=e,this.route=i,this.actions=n,this.location="",this.action=null,this.seen=!1,this.heard=!1}return _createClass(t,[{key:"isLocated",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.includes(this.location)}},{key:"updateLocation",value:function(t){void 0!==this.route[t]&&(this.location=this.route[t])}},{key:"updateAction",value:function(t){void 0!==this.actions[t]&&(this.action=this.actions[t])}},{key:"getName",value:function(){return this.identity.getName()}},{key:"describeAction",value:function(t){return""==t?"":this.getName()+" is "+t}},{key:"seenString",value:function(){return null===this.action?"":(this.identity.raiseFamiliarity(Familiarity.Indefinite),this.describeAction(this.action.getVisibleText()))}},{key:"seenIdentity",value:function(){return this.identity.raiseFamiliarity(Familiarity.Definite)}},{key:"heardString",value:function(){return null===this.action?"":this.describeAction(this.action.getAudibleText())}},{key:"heardIdentity",value:function(){return this.identity.raiseFamiliarity(Familiarity.Indefinite)}}]),t}();function formatList(t){if(0===(t=t.filter((function(t){return""!==t.trim()}))).length)return"";if(1===t.length)return t[0];if(2===t.length)return"".concat(t[0]," and ").concat(t[1]);var e=t.pop();return"".concat(t.join(", "),", and ").concat(e)}function getCharacters(){return[State.variables.governor,State.variables.guard]}function getObjects(){return[]}setup.identities={},setup.routes={},setup.actionOrders={},setup.characters={},setup.identities={},setup.identities.guard=new Identity("the night patrol guard","an armed guard","someone"),setup.identities.governor=new Identity("the governor","a mustached man in fancy business attire","someone"),setup.identities.guard.raiseToDefinite="You recognize this as the nightly patrol guard. He patrols this route every 10 minutes. Like you - he's very punctual.",setup.identities.guard.raiseToIndefinite="You think this is likely a patrolling guard.",setup.identities.governor.raiseToDefinite="To some, he's the pride of the people. To you, the governor is a run-of-the-mill charismatic fascist.",setup.routes.nightGuardPatrol={2:"Far Market Street",4:"Market Street",5:"Main St and Market St",9:"Main Street",11:"Capitol Building Exterior Front",12:"Capitol Building Exterior Courtyard",13:"Capitol Building Exterior Back",14:"Capitol Building Exterior Courtyard",15:"Main Street",17:"Main St and First",20:"First Steet",22:"Gone"},setup.routes.governorRoute={1:"Capitol Building Interior Entryway",4:"Capitol Building Exterior Front",6:"Main Street",8:"Main St and Market St",10:"Gone"},setup.actions={leavingFrontDoor:new Action("leaving through the front door","opening a door"),lockingFrontDoor:new Action("locking the front door behind him","handling keys and door lock"),walkingTowardMarket:new Action("walking toward Market St."),leavingTheArea:new Action("leaving the area for the night"),patrol:new Action("patrolling","making regular metal clanging sounds","clanging metal"),greetingGovernor:new Action("bidding the governor a good evening. The governor doesn't reply","bidding the governor a good evening. The governor doesn't reply","says something to the governor."),leavingOnPatrol:new Action("leaving the area. He should be back in 10 minutes. I should set my timer"),checkingTheDoor:new Action("checking the door to see if it's locked")},setup.actionOrders.nightGuardActions={1:setup.actions.patrol,8:setup.actions.greetingGovernor,9:setup.actions.patrol,11:setup.actions.checkingTheDoor,12:setup.actions.patrol,13:setup.actions.checkingTheDoor,14:setup.actions.patrol,18:setup.actions.leavingOnPatrol},setup.actionOrders.governorActions={4:setup.actions.leavingFrontDoor,5:setup.actions.lockingFrontDoor,6:setup.actions.walkingTowardMarket,8:setup.actions.leavingTheArea},State.variables.guard=new Character(setup.identities.guard,setup.routes.nightGuardPatrol,setup.actionOrders.nightGuardActions),State.variables.governor=new Character(setup.identities.governor,setup.routes.governorRoute,setup.actionOrders.governorActions),Macro.add("detect",{handler:function(){var t,e=this.args.shift(),i=this.args;if("see"===e||"hear"===e)t=getCharacters();else{if("smell"!==e)return new Wikifier(this.output,"Invalid sense: ".concat(e));t=getObjects()}var n="";return i.forEach((function(i){var r=t.filter((function(t){return t.location===i}));if(r.length>0){var a=r.map((function(t){return t.getName()}));n+="You ".concat(e," ").concat(formatList(a)," at ").concat(i,".")}})),new Wikifier(this.output,n)}});try{macros.ticktime={handler:function(t,e,i,n){State.variables.time+=1,State.variables.timer.ticktime();var r=this.movePerson;getCharacters().forEach((function(e){r(t,e)}))},movePerson:function(t,e){e.updateLocation(State.variables.time),e.updateAction(State.variables.time)}}}catch(t){throwError(place,"ticktime Setup Error: "+t.message)}try{macros.hear={handler:function(t,e,i,n){0!=i.length&&i.forEach((function(e){var i,n=[],r=[];getCharacters().forEach((function(t){t.isLocated(e)&&(r.push(t.heardString()),n.push(t.heardIdentity()))})),""!=(i=concatCommasAnd(r))&&(new Wikifier(t,"You hear "+i+" in "+e+".<br>"),n.forEach((function(e){""!=e&&new Wikifier(t,e+"<br>")})))}))}}}catch(t){throwError(place,"hear setup error: "+t.message)}try{macros.detected={handler:function(t,e,i,n){0!=i.length&&i.forEach((function(e){getCharacters().forEach((function(i){i.isLocated(e)&&new Wikifier(t,i.getName().toUpperFirst()+" detects you from "+e+".<br>")}))}))}}}catch(t){throwError(place,"detected setup error: "+t.message)}Macro.add("see",{handler:function(){var t=this.args,e=getCharacters(),i="";return t.forEach((function(t){var n=e.filter((function(e){return e.location===t}));if(n.length>0){var r=n.map((function(t){return t.getName()}));i+="You see ".concat(formatList(r)," at ").concat(t,".")}})),new Wikifier(this.output,i)}}),State.variables.time=0,State.variables.timer={isSet:!1,resetTo:60,countdownTime:60,ticktime:function(){this.isSet&&(this.countdownTime-=1)},reset:function(){this.countdownTime=this.resetTo}};