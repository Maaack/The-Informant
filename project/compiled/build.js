"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var Familiarity={Unknown:"Unknown",Indefinite:"Indefinite",Definite:"Definite"},Identity=function(){function e(t,i,n){_classCallCheck(this,e),this.definite=t,this.indefinite=i,this.unknown=n,this.state=Familiarity.Unknown,this.raiseToIndefinite="",this.raiseToDefinite=""}return _createClass(e,[{key:"getName",value:function(){switch(this.state){case Familiarity.Unknown:return this.unknown;case Familiarity.Indefinite:return this.indefinite;case Familiarity.Definite:return this.definite}}},{key:"printFamiliarityChange",value:function(e){switch(e){case Familiarity.Definite:return this.raiseToDefinite;case Familiarity.Indefinite:return this.raiseToIndefinite}return""}},{key:"raiseFamiliarity",value:function(e){return e in Familiarity&&this.state!=e?(this.state=e,this.printFamiliarityChange(e)):""}}]),e}(),Action=function(){function e(t,i,n){_classCallCheck(this,e),this.visibleText=t,this.audibleText=i,this.audibleFarText=n,this.wasSeen=!1,this.wasHeard=!1}return _createClass(e,[{key:"getVisibleText",value:function(){return this.wasSeen=!0,this.visibleText}},{key:"getAudibleText",value:function(){return this.wasSeen?"":(this.wasHeard=!0,this.audibleText)}},{key:"getAudibleFarText",value:function(){return this.wasSeen||this.wasHeard?"":(this.wasHeard=!0,this.audibleFarText)}}]),e}(),Character=function(){function e(t,i,n){_classCallCheck(this,e),this.identity=t,this.route=i,this.actions=n,this.location="",this.action=null,this.seen=!1,this.heard=!1}return _createClass(e,[{key:"isLocated",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.includes(this.location)}},{key:"updateLocation",value:function(e){void 0!==this.route[e]&&(this.location=this.route[e])}},{key:"updateAction",value:function(e){void 0!==this.actions[e]&&(this.action=this.actions[e])}},{key:"getName",value:function(){return this.identity.getName()}},{key:"describeAction",value:function(e){return""==e?"":this.getName()+" is "+e}},{key:"seenString",value:function(){return null===_typeof(this.action)?"":this.describeAction(this.action.getVisibleText())}},{key:"seenIdentity",value:function(){return this.identity.raiseFamiliarity(Familiarity.Definite)}},{key:"heardString",value:function(){return null===_typeof(this.action)?"":this.describeAction(this.action.getAudibleText())}},{key:"heardIdentity",value:function(){return this.identity.raiseFamiliarity(Familiarity.Indefinite)}}]),e}();function concatCommasAnd(e){if(1==e.length)return e[0];if(2==e.length)return e.join(" and ");if(e.length>2){var t=e.pop();return e.join(", ")+", and "+t}return""}setup.identities={},setup.routes={},setup.actionOrders={},setup.characters={},setup.identities.guard=new Identity("the night patrol guard","an armed guard","someone"),setup.identities.governor=new Identity("the governor","a man in fancily ordained business atire","someone"),setup.identities.guard.raiseToDefinite="You recognize this as the nightly patrol guard. He patrols this route every 10 minutes. Like you - he's very punctual.",setup.identities.guard.raiseToIndefinite="You think this is likely a patrolling guard.",setup.routes.nightGuardPatrol={2:"Far Market Street",4:"Market Street",5:"Main St and Market St",9:"Main Street",11:"Mayors Office Exterior Front",12:"Mayors Office Exterior Courtyard",13:"Mayors Office Exterior Back",14:"Mayors Office Exterior Courtyard",15:"Main Street",17:"Main St and First",20:"First Steet",22:"Gone"},setup.routes.governorRoute={1:"Mayors Office Interior Entryway",4:"Mayors Office Exterior Front",6:"Main Street",8:"Main St and Market St",22:"Gone"},setup.actions={patrol:new Action("patrolling","making regular metal clanging sounds","clanging metal"),greetingGovernor:new Action("bidding the governor a good evening. The governor doesn't reply","bidding the governor a good evening. The governor doesn't reply","says something to the governor.")},setup.actionOrders.nightGuardActions={1:setup.actions.patrol,8:setup.actions.greetingGovernor,9:setup.actions.patrol},setup.characters.guard=new Character(setup.identities.guard,setup.routes.nightGuardPatrol,setup.actionOrders.nightGuardActions),setup.characters.governor=new Character(setup.identities.governor,setup.routes.governorRoute,{}),State.variables.guard=setup.characters.guard,State.variables.mayor=setup.characters.governor;try{macros.ticktime={handler:function(e,t,i,n){State.variables.time+=1,State.variables.timer.ticktime();var r=this.movePerson;[setup.characters.guard].forEach((function(t){r(e,t)}))},movePerson:function(e,t){t.updateLocation(State.variables.time),t.updateAction(State.variables.time)}}}catch(e){throwError(place,"ticktime Setup Error: "+e.message)}try{macros.see={handler:function(e,t,i,n){0!=i.length&&i.forEach((function(t){var i,n=[],r=[];[setup.characters.guard].forEach((function(e){e.isLocated(t)&&(r.push(e.seenString()),n.push(e.seenIdentity()))})),""!=(i=concatCommasAnd(r))&&(new Wikifier(e,"You see "+i+" in "+t+".<br>"),n.forEach((function(t){""!=t&&new Wikifier(e,t+"<br>")})))}))}}}catch(e){throwError(place,"see setup error: "+e.message)}try{macros.hear={handler:function(e,t,i,n){0!=i.length&&i.forEach((function(t){var i,n=[],r=[];[setup.characters.guard].forEach((function(e){e.isLocated(t)&&(r.push(e.heardString()),n.push(e.heardIdentity()))})),""!=(i=concatCommasAnd(r))&&(new Wikifier(e,"You hear "+i+" in "+t+".<br>"),n.forEach((function(t){""!=t&&new Wikifier(e,t+"<br>")})))}))}}}catch(e){throwError(place,"hear setup error: "+e.message)}try{macros.opponentchecks={handler:function(e,t,i,n){}}}catch(e){throwError(place,"opponentchecks setup error: "+e.message)}State.variables.time=0,State.variables.timer={isSet:!1,resetTo:60,countdownTime:60,ticktime:function(){this.isSet&&(this.countdownTime-=1)},reset:function(){this.countdownTime=this.resetTo}};