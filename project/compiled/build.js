"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var Familiarity={Unknown:"Unknown",Indefinite:"Indefinite",Definite:"Definite"},Identity=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"someone",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"someone";_classCallCheck(this,e),this.definite=t,this.indefinite=i,this.unknown=n,this.state=Familiarity.Unknown,this.raiseToIndefinite="",this.raiseToDefinite=""}return _createClass(e,[{key:"getName",value:function(){switch(this.state){case Familiarity.Unknown:return this.unknown;case Familiarity.Indefinite:return this.indefinite;case Familiarity.Definite:return this.definite}}},{key:"getFamiliarityOrder",value:function(e){switch(e){case Familiarity.Unknown:return 0;case Familiarity.Indefinite:return 1;case Familiarity.Definite:return 2}}},{key:"isHigherFamiliarity",value:function(e){return this.getFamiliarityOrder(this.state)<this.getFamiliarityOrder(e)}},{key:"printFamiliarityChange",value:function(e){switch(e){case Familiarity.Definite:return this.raiseToDefinite;case Familiarity.Indefinite:return this.raiseToIndefinite}return""}},{key:"raiseFamiliarity",value:function(e){return e in Familiarity&&this.isHigherFamiliarity(e)?(this.state=e,this.printFamiliarityChange(e)):""}}]),e}(),Action=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";_classCallCheck(this,e),this.visibleText=t,this.audibleText=i,this.audibleFarText=n,this.wasSeen=!1,this.wasHeard=!1}return _createClass(e,[{key:"getVisibleText",value:function(){return this.wasSeen=!0,this.visibleText}},{key:"getAudibleText",value:function(){return this.wasSeen?"":(this.wasHeard=!0,this.audibleText)}},{key:"getAudibleFarText",value:function(){return this.wasSeen||this.wasHeard?"":(this.wasHeard=!0,this.audibleFarText)}}]),e}(),Character=function(){function e(t,i,n){_classCallCheck(this,e),this.identity=t,this.route=i,this.actions=n,this.location="",this.action=null,this.seen=!1,this.heard=!1}return _createClass(e,[{key:"isLocated",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.includes(this.location)}},{key:"updateLocation",value:function(e){void 0!==this.route[e]&&(this.location=this.route[e])}},{key:"updateAction",value:function(e){void 0!==this.actions[e]&&(this.action=this.actions[e])}},{key:"getName",value:function(){return this.identity.getName()}},{key:"describeAction",value:function(e){return""==e?"":this.getName()+" is "+e}},{key:"seenString",value:function(){return null===this.action?"":(this.identity.raiseFamiliarity(Familiarity.Indefinite),this.describeAction(this.action.getVisibleText()))}},{key:"seenIdentity",value:function(){return this.identity.raiseFamiliarity(Familiarity.Definite)}},{key:"heardString",value:function(){return null===this.action?"":this.describeAction(this.action.getAudibleText())}},{key:"heardIdentity",value:function(){return this.identity.raiseFamiliarity(Familiarity.Indefinite)}}]),e}();function concatCommasAnd(e){var t=[];if(e.forEach((function(e){""!=e&&t.push(e)})),1==t.length)return t[0];if(2==t.length)return t.join(" and ");if(t.length>2){var i=t.pop();return t.join(", ")+", and "+i}return""}setup.identities={},setup.routes={},setup.actionOrders={},setup.characters={},State.variables.identities={},State.variables.identities.guard=new Identity("the night patrol guard","an armed guard","someone"),State.variables.identities.governor=new Identity("the governor","a mustached man in fancy business attire","someone"),State.variables.identities.guard.raiseToDefinite="You recognize this as the nightly patrol guard. He patrols this route every 10 minutes. Like you - he's very punctual.",State.variables.identities.guard.raiseToIndefinite="You think this is likely a patrolling guard.",State.variables.identities.governor.raiseToDefinite="To some, he's the pride of the people. To you, the governor is a run-of-the-mill charismatic fascist.",setup.routes.nightGuardPatrol={2:"Far Market Street",4:"Market Street",5:"Main St and Market St",9:"Main Street",11:"Capitol Building Exterior Front",12:"Capitol Building Exterior Courtyard",13:"Capitol Building Exterior Back",14:"Capitol Building Exterior Courtyard",15:"Main Street",17:"Main St and First",20:"First Steet",22:"Gone"},setup.routes.governorRoute={1:"Capitol Building Interior Entryway",4:"Capitol Building Exterior Front",6:"Main Street",8:"Main St and Market St",10:"Gone"},setup.actions={leavingFrontDoor:new Action("leaving through the front door","opening a door"),lockingFrontDoor:new Action("locking the front door behind him","handling keys and door lock"),walkingTowardMarket:new Action("walking toward Market St."),leavingTheArea:new Action("leaving the area for the night"),patrol:new Action("patrolling","making regular metal clanging sounds","clanging metal"),greetingGovernor:new Action("bidding the governor a good evening. The governor doesn't reply","bidding the governor a good evening. The governor doesn't reply","says something to the governor."),leavingOnPatrol:new Action("leaving the area. He should be back in 10 minutes. I should set my timer"),checkingTheDoor:new Action("checking the door to see if it's locked")},setup.actionOrders.nightGuardActions={1:setup.actions.patrol,8:setup.actions.greetingGovernor,9:setup.actions.patrol,11:setup.actions.checkingTheDoor,12:setup.actions.patrol,13:setup.actions.checkingTheDoor,14:setup.actions.patrol,18:setup.actions.leavingOnPatrol},setup.actionOrders.governorActions={4:setup.actions.leavingFrontDoor,5:setup.actions.lockingFrontDoor,6:setup.actions.walkingTowardMarket,8:setup.actions.leavingTheArea},State.variables.guard=new Character(State.variables.identities.guard,setup.routes.nightGuardPatrol,setup.actionOrders.nightGuardActions),State.variables.governor=new Character(State.variables.identities.governor,setup.routes.governorRoute,setup.actionOrders.governorActions);try{macros.ticktime={handler:function(e,t,i,n){State.variables.time+=1,State.variables.timer.ticktime();var r=this.movePerson;getCharacters().forEach((function(t){r(e,t)}))},movePerson:function(e,t){t.updateLocation(State.variables.time),t.updateAction(State.variables.time)}}}catch(e){throwError(place,"ticktime Setup Error: "+e.message)}try{macros.see={handler:function(e,t,i,n){0!=i.length&&i.forEach((function(t){var i,n=[],r=[];getCharacters().forEach((function(e){e.isLocated(t)&&(r.push(e.seenString()),n.push(e.seenIdentity()))})),""!=(i=concatCommasAnd(r))&&(new Wikifier(e,"You see "+i+" in "+t+".<br>"),n.forEach((function(t){""!=t&&new Wikifier(e,t+"<br>")})))}))}}}catch(e){throwError(place,"see setup error: "+e.message)}try{macros.hear={handler:function(e,t,i,n){0!=i.length&&i.forEach((function(t){var i,n=[],r=[];getCharacters().forEach((function(e){e.isLocated(t)&&(r.push(e.heardString()),n.push(e.heardIdentity()))})),""!=(i=concatCommasAnd(r))&&(new Wikifier(e,"You hear "+i+" in "+t+".<br>"),n.forEach((function(t){""!=t&&new Wikifier(e,t+"<br>")})))}))}}}catch(e){throwError(place,"hear setup error: "+e.message)}try{macros.opponentchecks={handler:function(e,t,i,n){}}}catch(e){throwError(place,"opponentchecks setup error: "+e.message)}function getCharacters(){return[State.variables.governor,State.variables.guard]}State.variables.time=0,State.variables.timer={isSet:!1,resetTo:60,countdownTime:60,ticktime:function(){this.isSet&&(this.countdownTime-=1)},reset:function(){this.countdownTime=this.resetTo}};